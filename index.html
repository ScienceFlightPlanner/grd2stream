<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>grd2stream Manual</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1 {
            color: #2D3E50;
            border-bottom: 2px solid #3498DB;
            padding-bottom: 10px;
        }
        h2 {
            color: #2980B9;
            margin-top: 30px;
        }
        h3 {
            color: #3498DB;
        }
        code {
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .note {
            background: #e7f5fe;
            border-left: 4px solid #3498DB;
            padding: 10px 15px;
            margin: 20px 0;
        }
        .warning {
            background: #ffeaea;
            border-left: 4px solid #E74C3C;
            padding: 10px 15px;
            margin: 20px 0;
        }
        img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
            margin: 10px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>grd2stream QGIS Plugin - User Manual</h1>

    <h2>Table of Contents</h2>
    <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#basic-usage">Basic Usage</a></li>
        <li><a href="#parameters">Parameters</a></li>
        <li><a href="#presets">Working with Presets</a></li>
        <li><a href="#technical-details">Technical Details</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
    </ul>

    <h2 id="overview">Overview</h2>
    <p>
        The grd2stream QGIS Plugin allows you to extract and visualize vector flowlines from raster gradient fields.
        This is particularly useful for analyzing fluid flow directions, topographic gradients,
        and other directional vector data represented in raster format.
    </p>

    <div class="note">
        <strong>Note:</strong> This plugin requires two raster datasets representing the X and Y components of a
        gradient field. These can be derived from a single field (like a DEM) or can represent measured
        vector components.
    </div>

    <h2 id="installation">Installation</h2>
    <p>
        The grd2stream QGIS Plugin has specific requirements for some of its functionality:
    </p>

    <h3>Dependencies</h3>
    <ul>
        <li>GMT (Generic Mapping Tools) 6.x</li>
        <li>GDAL library</li>
        <li>grd2stream utility</li>
    </ul>

    <p>
        The plugin can help you install these dependencies if they are not already available on your system.
    </p>

    <h3>Platform-Specific Installation Notes</h3>

    <h4>Windows</h4>
    <p>
        On Windows, the plugin uses WSL (Windows Subsystem for Linux) to run the GMT and grd2stream utilities. If not already installed, you'll be prompted to install WSL and the necessary dependencies through the plugin interface.
    </p>

    <h4>Linux and macOS</h4>
    <p>
        On Linux and macOS, the plugin can install and manage a Miniconda environment with the necessary dependencies. The environment will be created in your home directory under <code>~/miniconda3</code>.
    </p>

    <h3>Installation Process</h3>
    <ol>
        <li>Install the plugin through the QGIS Plugin Manager</li>
        <li>When first using the plugin, it will check for dependencies</li>
        <li>If dependencies are missing, you'll be prompted to install them</li>
        <li>Follow the on-screen instructions to complete the installation</li>
    </ol>

    <h2 id="basic-usage">Basic Usage</h2>

    <h3>Extracting Flowlines</h3>
    <ol>
        <li>Click the grd2stream plugin button in the QGIS toolbar</li>
        <li>Select your two input raster layers representing X and Y gradient components</li>
        <li>Set parameters for the flowline extraction</li>
        <li>Choose a method for selecting the seed point (map click or manual coordinates)</li>
        <li>Execute the flowline extraction</li>
    </ol>

    <p>
        The plugin will generate a vector layer with the extracted flowline, which will be
        automatically added to your QGIS project.
    </p>

    <h3>Choosing Input Rasters</h3>
    <p>
        The plugin requires two raster layers:
    </p>
    <ul>
        <li>The first raster should represent the X (east-west) component of the gradient field</li>
        <li>The second raster should represent the Y (north-south) component of the gradient field</li>
    </ul>

    <p>
        If your rasters have multiple bands, you can specify which band to use for each raster.
    </p>

    <h3>Selecting a Seed Point</h3>
    <p>
        After configuring the parameters, you'll be prompted to select a seed point for the flowline. You can:
    </p>
    <ul>
        <li><strong>Click on the map</strong>: Interactively select a point on the map view</li>
        <li><strong>Enter coordinates manually</strong>: Enter exact X and Y coordinates in the current project CRS</li>
    </ul>

    <h2 id="parameters">Parameters</h2>

    <h3>Main Settings</h3>
    <table>
        <tr>
            <th>Parameter</th>
            <th>Description</th>
            <th>Default</th>
        </tr>
        <tr>
            <td>Backward Steps</td>
            <td>Enable to trace the flowline in the upstream direction</td>
            <td>Disabled</td>
        </tr>
        <tr>
            <td>Step Size</td>
            <td>Distance increment for each step of the flowline integration</td>
            <td>min(x_inc, y_inc) / 5</td>
        </tr>
        <tr>
            <td>Maximum Steps</td>
            <td>Maximum number of steps to take when tracing the flowline</td>
            <td>10,000</td>
        </tr>
        <tr>
            <td>Maximum Integration Time</td>
            <td>Maximum time allowed for the flowline integration process</td>
            <td>Unlimited</td>
        </tr>
        <tr>
            <td>Output Format</td>
            <td>Format of the flowline data</td>
            <td>x y dist</td>
        </tr>
    </table>

    <h3>Output Formats</h3>
    <ul>
        <li><code>x y dist</code> - Coordinates and distance</li>
        <li><code>x y dist v_x v_y</code> - Coordinates, distance, and velocity components</li>
        <li><code>x y dist v_x v_y time</code> - Coordinates, distance, velocity components, and integration time</li>
    </ul>

    <h2 id="presets">Working with Presets</h2>
    <p>
        The preset system allows you to save frequently used configurations for easy reuse.
    </p>

    <h3>Saving a Preset</h3>
    <ol>
        <li>Configure your parameters in the main dialog</li>
        <li>Click "Save as Preset"</li>
        <li>Enter a name for your preset</li>
    </ol>

    <h3>Loading a Preset</h3>
    <ol>
        <li>Click "Load Preset" in the main dialog</li>
        <li>Select a preset from the list</li>
        <li>Click "Select"</li>
    </ol>

    <h3>Managing Presets</h3>
    <p>
        You can view and manage your saved presets through the preset dialog. For each preset, you can:
    </p>
    <ul>
        <li><strong>View details</strong>: Hover over a preset to see its settings</li>
        <li><strong>Edit</strong>: Modify existing presets by clicking the "View/Edit" button</li>
        <li><strong>Delete</strong>: Remove presets that are no longer needed</li>
    </ul>

    <p>
        Presets are saved in a JSON file in the plugin directory and are persistent between QGIS sessions.
    </p>

    <h3>Using Last Settings</h3>
    <p>
        You can quickly reuse the last used settings by clicking the "Use Last Settings" button in the main dialog.
        This will either load the last used preset or the last manually configured settings.
    </p>

    <h2 id="technical-details">Technical Details</h2>

    <h3>How Flowlines Are Generated</h3>
    <p>
        The grd2stream plugin uses the grd2stream utility (part of the GMT suite) to trace streamlines through 2D vector fields. The process works as follows:
    </p>
    <ol>
        <li>The plugin reads the vector field from the two input rasters</li>
        <li>Starting from the seed point, the utility integrates along the vector field</li>
        <li>The integration uses a 4th-order Runge-Kutta method to trace the path</li>
        <li>The process continues until a boundary is reached or the maximum steps/time is exceeded</li>
    </ol>

    <h3>Output Vector Layer</h3>
    <p>
        The output is a point vector layer with points along the flowline. Depending on the selected output format, each point contains:
    </p>
    <ul>
        <li>X and Y coordinates in the project CRS</li>
        <li>Distance along the flowline</li>
        <li>Optionally, velocity components at each point</li>
        <li>Optionally, integration time</li>
    </ul>

    <h3>Data Formats</h3>
    <p>
        The plugin supports various raster formats through GDAL, including:
    </p>
    <ul>
        <li>GeoTIFF</li>
        <li>NetCDF</li>
        <li>HDF5</li>
        <li>GRIB</li>
        <li>Other GDAL-supported formats</li>
    </ul>

    <p>
        For NetCDF, HDF5, and GRIB files with multiple variables, you can specify the variable to use by selecting the appropriate band.
    </p>

    <h2 id="troubleshooting">Troubleshooting</h2>

    <h3>Common Issues</h3>

    <h4>Missing Dependencies</h4>
    <p>
        If the plugin cannot find the necessary dependencies, it will prompt you to install them. Make sure to follow the installation instructions carefully.
    </p>

    <h4>Invalid Input Rasters</h4>
    <p>
        If your input rasters don't represent valid vector components, the flowline generation may fail or produce unexpected results. Ensure that:
    </p>
    <ul>
        <li>Both rasters have the same extent and resolution</li>
        <li>The data represents vector components in the X and Y directions</li>
        <li>The data values are in compatible units</li>
    </ul>

    <h4>No Flowline Generated</h4>
    <p>
        If no flowline is generated, possible causes include:
    </p>
    <ul>
        <li>The seed point is in an area with zero or undefined vector values</li>
        <li>The step size is too large relative to the vector field's spatial variability</li>
        <li>The maximum steps or integration time is too low</li>
    </ul>

    <h3>Windows-Specific Issues</h3>
    <p>
        On Windows, the plugin relies on WSL. Common issues include:
    </p>
    <ul>
        <li>WSL not properly installed or configured</li>
        <li>Permissions issues with file access between Windows and WSL</li>
        <li>Path conversion problems with special characters in filenames or paths</li>
    </ul>

    <h3>Reporting Problems</h3>
    <p>
        If you encounter issues not covered in this troubleshooting section, please report them with:
    </p>
    <ul>
        <li>A detailed description of the problem</li>
        <li>The steps taken that led to the issue</li>
        <li>Error messages (check the QGIS log panel)</li>
        <li>Sample data if possible</li>
    </ul>

    <div class="warning">
        <strong>Note:</strong> Check the QGIS log panel (View → Panels → Log Messages) for detailed error messages that may help diagnose issues.
    </div>

    <h3>Contact Information</h3>
    <p>
        For support or to report issues, please contact:
    </p>
    <ul>
        <li>Thomas Kleiner (Author)</li>
        <li>Abraham Wondimu (Contributor)</li>
    </ul>

    <p>&copy; 2013-2025 Thomas Kleiner & Abraham Wondimu</p>
</body>
</html>